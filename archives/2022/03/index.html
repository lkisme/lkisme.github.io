
<!DOCTYPE html>
<html lang="zh-cn,en,default">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="种豆南山下">
    <title>归档: 2022/3 - 种豆南山下</title>
    <meta name="author" content="KK">
    
    
    
    <script type="application/ld+json">{}</script>
    <meta property="og:type" content="blog">
<meta property="og:title" content="种豆南山下">
<meta property="og:url" content="http://lkisme.github.io/archives/2022/03/index.html">
<meta property="og:site_name" content="种豆南山下">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="KK">
<meta name="twitter:card" content="summary">
    
    
        
    
    
    
    
    
    <!--STYLES-->
    
<link rel="stylesheet" href="/assets/css/style-lhkgplcxswfqcqxi6ypsogyzfsjpm0ca82ziuhsial2qxh8cicqqolprsrnr.min.css">

    <!--STYLES END-->
    

    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a
            class="header-title-link"
            href="/"
            aria-label=""
        >
            种豆南山下
        </a>
    </div>
    
        
            <a
                class="header-right-picture "
                href="#about"
                aria-label="打开链接: /#about"
            >
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="1">
    <div class="sidebar-container">
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/"
                            
                            rel="noopener"
                            title="首页"
                        >
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-categories"
                            
                            rel="noopener"
                            title="分类"
                        >
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-tags"
                            
                            rel="noopener"
                            title="标签"
                        >
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/all-archives"
                            
                            rel="noopener"
                            title="归档"
                        >
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link open-algolia-search"
                            href="#search"
                            
                            rel="noopener"
                            title="搜索"
                        >
                        <i class="sidebar-button-icon fa fa-search" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">搜索</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="#about"
                            
                            rel="noopener"
                            title="关于"
                        >
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://github.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="GitHub"
                        >
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="http://stackoverflow.com/users"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Stack Overflow"
                        >
                        <i class="sidebar-button-icon fab fa-stack-overflow" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Stack Overflow</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://twitter.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Twitter"
                        >
                        <i class="sidebar-button-icon fab fa-twitter" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Twitter</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://facebook.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Facebook"
                        >
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://plus.google.com/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="Google Plus"
                        >
                        <i class="sidebar-button-icon fab fa-google-plus" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Google Plus</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="https://www.linkedin.com/profile/"
                            
                                target="_blank"
                            
                            rel="noopener"
                            title="LinkedIn"
                        >
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/mailto"
                            
                            rel="noopener"
                            title="邮箱"
                        >
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">邮箱</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a
                            class="sidebar-button-link "
                            href="/atom.xml"
                            
                            rel="noopener"
                            title="RSS"
                        >
                        <i class="sidebar-button-icon fa fa-rss" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">RSS</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="1"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a
                            class="link-unstyled"
                            href="/p/esp8266-control-daikin-ac/"
                            aria-label=": 大金空调面板Hack添加WiFi支持"
                        >
                            大金空调面板Hack添加WiFi支持
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2022-03-29T06:59:12+00:00">
	
		    3月 29, 2022
    	
    </time>
    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h1 id="大金空调面板Hack添加WiFi支持"><a href="#大金空调面板Hack添加WiFi支持" class="headerlink" title="大金空调面板Hack添加WiFi支持"></a>大金空调面板Hack添加WiFi支持</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>装修时家里装了大金的1拖2中央空调，当时可以选“金制家中”的套餐，只要加1000块，结果脑抽没选。入住之后马上感觉到不爽的地方：</p>
<ol>
<li>无法远程控制：夏天下班回家后，家里还是很热，立马开空调也要过几分钟才会凉下来，冬天同理。</li>
<li>无法远程控制：冬天要起床开关空调，</li>
<li>其他扩展功能：定时关定时开只能在面板上选择，且只能以半小时为单位。</li>
<li>指示灯的问题：晚上睡觉指示灯一直亮着，烦人</li>
</ol>
<h2 id="可选方案"><a href="#可选方案" class="headerlink" title="可选方案"></a>可选方案</h2><p>首先是想买一套金制家中，大概就是一个Wi-Fi网关+几个传感器，这个主要问题是要装在外机上（大误），于是放弃了，继续搜索可以接入米家控制的设备，大概有三种：</p>
<ol>
<li>大金官方的方案：WiFi控制器（金制家中）</li>
<li>vrf面板，价格在300-600之间，要替换掉自带面板，特点是安装简单，且可以卖掉原版的线控，回一波血</li>
<li>线控网关，原理和#1一样，接在空调内机的P1&#x2F;P2上，价格在300-400之间。安装比较麻烦</li>
<li>集控网关，原理和金制家中一样，接在F1&#x2F;F2上，可以控制所有内机。价格在1000-2000之间，安装难度和#2一样，特点是一台机器可以控制所有内机，如果家里内机较多，可以考虑这个</li>
<li>DIY：难度较高</li>
</ol>
<h2 id="原理分析"><a href="#原理分析" class="headerlink" title="原理分析"></a>原理分析</h2><p>下图是线控网关的安装拓扑</p>
<img width="645" alt="xiankong" src="https://user-images.githubusercontent.com/2712885/144000776-37a099fd-2056-4140-bc03-1bcf7cb4c0b5.png">
对于大金空调的控制，大概的方式可以分为2种

<h3 id="F1-x2F-F2"><a href="#F1-x2F-F2" class="headerlink" title="F1&#x2F;F2"></a>F1&#x2F;F2</h3><p>单台外机：空调网关的F1&#x2F;F2连接大金中央空调的室内机或者室外机的“F1&#x2F;F2”。<br>多台外机：空调网关的F1&#x2F;F2连接大金中央空调室外机的“F1F2”。</p>
<p>金制家中应该就是这种方案，此外集控网关也是这种方案，优点是一台机器控制所有空调。<br><img src="https://user-images.githubusercontent.com/2712885/144000705-39cbc944-6fdf-4b57-98e2-7dacc64d3f5c.jpg" alt="jikong"></p>
<h3 id="P1-x2F-P2"><a href="#P1-x2F-P2" class="headerlink" title="P1&#x2F;P2"></a>P1&#x2F;P2</h3><p>基于HBS协议的载波通信。没有太深入的了解，大概就是这两根线既可以提供电源（压差大概15V多一点），又可以载波通信（高20V，低10V）。国内可以买到的很多线控网关都是做了一个HBS的解析器+控制器。网上也有开源的方案，但要自己做硬件，于是放弃。<br><img src="https://user-images.githubusercontent.com/2712885/144000648-b6d5cf7c-6c57-4ea9-88b1-d5709a9bb5c8.png" alt="hbs-chip"></p>
<p>所有的线控都是内机-&gt;解码-&gt;控制器-&gt;网关这样的链路。而自带的面板只是缺了「网关」这一环，所以我们可以制作一个可以控制面板的带有网关功能的设备，就可以轻松实现联网控制空调了。</p>
<h2 id="实操"><a href="#实操" class="headerlink" title="实操"></a>实操</h2><p>首先我买了一个线控网关，接起来真的费劲，接线图如下所示：</p>
<p>其原理上边讲了，相当于一个内机接了2个遥控，第二个遥控配上了WiFi网关。</p>
<p>第二个内机不想再买线控网关了，觉得这看起来功能很简单啊，于是在网上搜相关的方案，搜到了这个：<a target="_blank" rel="noopener" href="https://lecoding.com/post/2020/daikin-remote-controller-hack/">https://lecoding.com/post/2020/daikin-remote-controller-hack/</a> ，这偏文章里通过红外来控制原始的控制面板，但有以下几个问题：如果需要远程控制，需要再加一个红外网关。而我最近在研究8266，手里拿着锤子看见所有东西都是钉子，于是开始改造。但改造失败，因为接上8266之后面板就会重启，之后会不断的重启，另外由于没有断电操作，把面板上的电源指示灯LED烧了，额外解决了最开始的#4个诉求。。。</p>
<p><img src="https://user-images.githubusercontent.com/2712885/144226767-0e6ff656-9adb-4948-8b66-f4ee0aca2bbd.jpg" alt="front_before"></p>
<p>改造计划暂时搁置，最近又在英文世界里冲浪，找找老外的解决方案，找到了一个使用Arduino来解决问题的：<a target="_blank" rel="noopener" href="https://mattala.com.au/2016/08/14/airduino-network-enabling-the-daikin-vrv-with-the-brc1d61-or-similar-thermostats/">AIRDUINO | ADDING NETWORK REMOTE CONTROL TO THE DAIKIN VRV WITH THE BRC1D61 OR SIMILAR THERMOSTATS</a>，于是又燃起了改造的激情，这次增加了读取LED状态的接线，这样就能精确控制空调了。接线如下：<br><img src="https://user-images.githubusercontent.com/2712885/144226833-8ad835fd-67be-4d16-a9c5-cabd103a09f9.jpg" alt="front_done"></p>
<p><img src="https://user-images.githubusercontent.com/2712885/144226809-9030fd06-a16e-4151-8d8b-39529d08844e.jpg" alt="back"></p>
<h3 id="电源问题"><a href="#电源问题" class="headerlink" title="电源问题"></a>电源问题</h3><p>接上之后好了几个小时，面板又重启了，另外一接上8266，就能听到滋滋的声音，应该是面板上15V转5V的变压器受不了额外的载荷，发出了以此抖动的声音。于是不得已，又从相邻的卧室灯开关的接线盒拉出来了220V的线：</p>
<h2 id="最终方案"><a href="#最终方案" class="headerlink" title="最终方案"></a>最终方案</h2><ol>
<li>220V接AC-DC电源变3.3V接8266电源，将8266和电源塞进了面板背后的86接线盒内</li>
<li>面板的GND接8266的GND</li>
<li>面板的2条引线分别串联20K左右的电阻，接8266的GPIO引脚</li>
<li>HA配置如下所示</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- platform: mqtt</span><br><span class="line">  name: &quot;卧室空调&quot;</span><br><span class="line">  unique_id: switch.wifi.bedroom_ac</span><br><span class="line">  payload_on: &quot;1&quot;</span><br><span class="line">  payload_off: &quot;0&quot;</span><br><span class="line">  state_topic: daikin/bedroom/state</span><br><span class="line">  command_topic: daikin/bedroom/command</span><br><span class="line">  availability_topic: daikin/bedroom/availability</span><br><span class="line">  json_attributes_topic: daikin/bedroom/attrs</span><br></pre></td></tr></table></figure>


<p>家里有一台N1装了HASS+NodeRed+MQTT，自制了一个离线的语音控制器放在卧室，这样就可以开关（灯、暖气、空调、其他）基本靠吼了。</p>

                    
                        


                    
                    
                        <p>
                            <a
                                href="/p/esp8266-control-daikin-ac/#post-footer"
                                class="postShorten-excerpt_link link"
                                aria-label=""
                            >
                                评论和共享
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">第 1 页 共 1 页</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2022 KK. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <h4 id="about-card-name">KK</h4>
        
            <div id="about-card-bio"><p>author.bio</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>author.job</p>

            </div>
        
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->

<script src="/assets/js/script-zs5hm9dwiuordij06gece5qumkv8p0tgxjmg67o6479woxf9axo6nsztr9st.min.js"></script>

<!--SCRIPTS END-->





    </body>
</html>
